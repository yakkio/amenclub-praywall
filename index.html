<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pray-wall</title>
<meta name="theme-color" content="#FFFFFF">
<style>
  
  /* Paperlogy font */
  @font-face {
    font-family:'Paperlogy','Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Malgun Gothic',sans-serif;
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2307@1.1/Paperlogy-6SemiBold.woff2') format('woff2');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }

  :root{
    --bg:#FFFFFF; --card:#FFFFFF; --ink:#333333; --muted:#666666; --line:#E5E7EB; --brand:#333333;
    --heart:#333333; --warn:#B91C1C; --okay:#16A34A;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",sans-serif;
    background:var(--bg); color:var(--ink);
  }
  header{
    position:sticky; top:0; background:var(--card); border-bottom:1px solid var(--line); z-index:10;
  }
  .wrap{max-width:720px; margin:0 auto; padding:0 16px;}
  .bar{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:14px 0;}
  .brand{font-weight:800; letter-spacing:.2px;}
  .sub{color:var(--muted); font-size:12px;}
  .composer{
    background:var(--card); border:1px solid var(--line);
    border-radius:14px; padding:12px; box-shadow:0 1px 2px rgba(0,0,0,.03); margin:14px 0;
  }
  textarea{
    width:100%; border:none; resize:none; min-height:86px; outline:none; background:transparent; color:var(--ink);
    font-size:16px; line-height:1.5;
  }
  .row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px; flex-wrap:wrap}
  .muted{color:var(--muted); font-size:12px;}
  .btn{
    border:1px solid var(--line); background:var(--card); color:var(--ink); padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
  }
  .btn.primary{background:var(--brand); color:#fff; border-color:var(--brand)}
  .btn[disabled]{opacity:.5; cursor:not-allowed}
  .feed{display:flex; flex-direction:column; gap:12px; margin:16px 0 96px}
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px;
    box-shadow:0 1px 2px rgba(0,0,0,.03);
  }
  .text{white-space:pre-wrap; word-break:break-word; font-size:16px; line-height:1.6;}
  .meta{display:flex; align-items:center; justify-content:space-between; margin-top:10px; gap:8px; flex-wrap:wrap}
  .time{font-size:12px; color:var(--muted);}
  .actions{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .chip{
    display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px; border:1px solid var(--line);
    background:#FAFAFA; cursor:pointer; user-select:none; color:var(--ink);
  }
  .chip.heart .ico{color:var(--heart)}
  .chip.report{border-color:#FEE2E2; background:#FEF2F2}
  .chip.report .ico{color:var(--warn)}
  .count{font-weight:700}
  .ghost{
    border:none; background:transparent; color:var(--muted); cursor:pointer; padding:8px 10px; border-radius:8px;
  }
  .ghost:hover{background:#F7F7F7}
  footer{
    position:fixed; bottom:0; left:0; right:0; background:linear-gradient(transparent, rgba(255,255,255,.95) 18%, rgba(255,255,255,1)); padding-bottom:10px;
  }
  .util{
    max-width:720px; margin:0 auto; padding:8px 16px; display:flex; gap:8px; justify-content:space-between; flex-wrap:wrap;
  }
  .util .btn, .util .ghost{flex:1; min-width:140px}
  .notice{
    background:#F9FAFB; border:1px dashed var(--line); border-radius:12px; padding:10px; font-size:12px; color:var(--muted); margin-top:6px;
  }
  .warn{color:var(--warn); font-weight:700}
  .ok{color:var(--okay); font-weight:700}
  .hidden{display:none !important}
</style>
</head>
<body>
  <header>
    <div class="wrap bar" style="justify-content:center;">
      <div>
        <div class="brand">Pray-wall</div>
        
      </div>
      
    </div>
  </header>

  <main class="wrap">
    <section class="composer" aria-label="Í∏∞ÎèÑ Í∏Ä ÏûëÏÑ±">
      <textarea id="postInput" maxlength="500" placeholder="Í∏∞ÎèÑÏ†úÎ™©ÏùÑ ÏßßÍ≤å ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî (ÏµúÎåÄ 500Ïûê). ÎåìÍ∏ÄÏùÄ ÏóÜÍ≥†, ÌïòÌä∏ÏôÄ Ïã†Í≥† Î≤ÑÌäºÎßå ÏûàÏñ¥Ïöî."></textarea>
      <div class="row">
        <div class="muted"><span id="count">0</span> / 500</div>
        <div>
          <button class="btn" id="clearBtn" title="ÏßÄÏö∞Í∏∞">ÏßÄÏö∞Í∏∞</button>
          <button class="btn primary" id="postBtn" disabled>Ïò¨Î¶¨Í∏∞</button>
        </div>
        <div class="notice">Ï£ºÏùò: Í∞úÏù∏Ï†ïÎ≥¥, ÎπÑÎ∞©, Í¥ëÍ≥†, Ï†ïÏπò¬∑ÏÑ†Îèô, Î¨¥Îã® ÌôçÎ≥¥ Îì±ÏùÄ <span class="warn">Ïã†Í≥†</span> ÎåÄÏÉÅÏûÖÎãàÎã§. Î∞òÎ≥µ Ïãú Ïù¥Ïö© Ï†úÌïúÎê† Ïàò ÏûàÏñ¥Ïöî.</div>
      </div>
    </section>

    <section class="feed" id="feed" aria-live="polite"></section>
  </main>

  <footer>
    <div class="util">
      <button class="btn" id="exportBtn" title="Î∞±ÏóÖ ÎÇ¥Î≥¥ÎÇ¥Í∏∞">Î∞±ÏóÖ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
      <button class="btn" id="importBtn" title="Î∞±ÏóÖ Î∂àÎü¨Ïò§Í∏∞">Î∞±ÏóÖ Î∂àÎü¨Ïò§Í∏∞</button>
      <button class="btn" id="wipeBtn" title="Ï†ÑÏ≤¥ ÏÇ≠Ï†ú">Ïù¥ Í∏∞Í∏∞ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</button>
    </div>
  </footer>

<script>
(() => {
  const LS_KEY = "amenclub_praywall_posts_v2";
  const AMEN_KEY = "amenclub_praywall_amen_v1";
  const HALLE_KEY = "amenclub_praywall_halle_v1";
  const REPORT_KEY = "amenclub_praywall_reports_v2";
  const DEVICE_KEY = "amenclub_device_id";
  const LAST_POST_KEY = "amenclub_last_post_ts";
  const POST_COOLDOWN_MS = 0; // Ïø®Îã§Ïö¥ ÎπÑÌôúÏÑ±Ìôî

  const blacklist = ["ÏöïÏÑ§1","ÏöïÏÑ§2","http://","https://"]; // ÌïÑÏöî Ïãú Îã®Ïñ¥ Î≥¥Í∞ï

  const $ = sel => document.querySelector(sel);
  const $$ = sel => document.querySelectorAll(sel);

  const feed = $("#feed");
  const postInput = $("#postInput");
  const postBtn = $("#postBtn");
  const clearBtn = $("#clearBtn");
  const count = $("#count");
  const exportBtn = $("#exportBtn");
  const importBtn = $("#importBtn");
  const wipeBtn = $("#wipeBtn");
  const refreshBtn = $("#refreshBtn");

  function getDeviceId(){
    let id = localStorage.getItem(DEVICE_KEY);
    if(!id){
      id = "dev_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
      localStorage.setItem(DEVICE_KEY, id);
    }
    return id;
  }
  const deviceId = getDeviceId();

  function now(){ return Date.now(); }
  function load(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    }catch(e){ return fallback; }
  }
  function save(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  let posts = load(LS_KEY, []).sort((a,b)=>b.ts-a.ts);
  let amenMap = load(AMEN_KEY, {});
  let halleMap = load(HALLE_KEY, {});
  let reportMap = load(REPORT_KEY, {});

  function sanitize(input){
    // strip HTML tags & trim
    const txt = input.replace(/<[^>]*>?/gm, "").trim();
    return txt;
  }
  function blocked(input){
    const low = input.toLowerCase();
    return blacklist.some(w => low.includes(w.toLowerCase()));
  }
  function fmt(ts){
    const d = new Date(ts);
    const pad = n => String(n).padStart(2,"0");
    return `${d.getFullYear()}.${pad(d.getMonth()+1)}.${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  function render(){
    feed.innerHTML = "";
    const visible = posts.filter(p => !reportMap[p.id]?.hidden); // locally hidden if reported by me
    if(visible.length === 0){
      const empty = document.createElement("div");
      empty.className = "card muted";
      empty.style.textAlign="center";
      empty.style.padding="24px";
      empty.textContent = "Ï≤´ Í∏ÄÏùÑ Ïò¨Î†§Î≥¥ÏÑ∏Ïöî. ÌïòÌä∏Î°ú Ìï®Íªò Í∏∞ÎèÑÌï¥Ïöî üôè";
      feed.appendChild(empty);
      return;
    }
    visible.forEach(p => {
      const card = document.createElement("article");
      card.className = "card";
      card.setAttribute("data-id", p.id);

      const txt = document.createElement("div");
      txt.className = "text";
      txt.textContent = p.text;

      const meta = document.createElement("div");
      meta.className = "meta";

      const time = document.createElement("div");
      time.className = "time";
      const repCount = p.reports || 0;
      time.innerHTML = `${fmt(p.ts)}${repCount>0 ? ` ¬∑ Ïã†Í≥† ${repCount}`:""}`;

      const actions = document.createElement("div");
      actions.className = "actions";

      // Amen chip
      const amen = document.createElement("button");
      amen.className = "chip";
      const amenOn = !!amenMap[p.id];
      amen.setAttribute("aria-pressed", amenOn ? "true" : "false");
      amen.innerHTML = `<span>ÏïÑÎ©ò</span><span class="count">${p.amen||0}</span>`;
      amen.addEventListener("click", () => {
        if(amenMap[p.id]){
          amenMap[p.id] = false;
          p.amen = Math.max(0, (p.amen||0) - 1);
          amen.setAttribute("aria-pressed","false");
        }else{
          amenMap[p.id] = true;
          p.amen = (p.amen||0) + 1;
          amen.setAttribute("aria-pressed","true");
        }
        save(AMEN_KEY, amenMap);
        save(LS_KEY, posts);
        amen.querySelector(".count").textContent = p.amen || 0;
      });
      actions.appendChild(amen);

      // Hallelujah chip
      const halle = document.createElement("button");
      halle.className = "chip";
      const halleOn = !!halleMap[p.id];
      halle.setAttribute("aria-pressed", halleOn ? "true" : "false");
      halle.innerHTML = `<span>Ìï†Î†êÎ£®Ïïº</span><span class="count">${p.halle||0}</span>`;
      halle.addEventListener("click", () => {
        if(halleMap[p.id]){
          halleMap[p.id] = false;
          p.halle = Math.max(0, (p.halle||0) - 1);
          halle.setAttribute("aria-pressed","false");
        }else{
          halleMap[p.id] = true;
          p.halle = (p.halle||0) + 1;
          halle.setAttribute("aria-pressed","true");
        }
        save(HALLE_KEY, halleMap);
        save(LS_KEY, posts);
        halle.querySelector(".count").textContent = p.halle || 0;
      });
      actions.appendChild(halle);

      // Report
      const reportBtn = document.createElement("button");
      reportBtn.className = "chip report";
      reportBtn.innerHTML = `<span class="ico">‚öë</span><span>Ïã†Í≥†</span>`;
      reportBtn.addEventListener("click", () => {
        if(confirm("Ïù¥ Í∏ÄÏùÑ Ïã†Í≥†Ìï†ÍπåÏöî? Î∂ÄÏ†ÅÏ†àÌïú ÎÇ¥Ïö©ÏùÄ Ïà®Í≤®ÏßÄÍ≥†, Ïã†Í≥† ÏàòÍ∞Ä Í∏∞Î°ùÎê©ÎãàÎã§.")){
          p.reports = (p.reports||0) + 1;
          reportMap[p.id] = { hidden:true, at: now() };
          save(REPORT_KEY, reportMap);
          save(LS_KEY, posts);
          render();
        }
      });
      actions.appendChild(reportBtn);

      // delete button (only owner on this device)
      if(p.owner === deviceId){
        const del = document.createElement("button");
        del.className = "ghost";
        del.textContent = "ÏÇ≠Ï†ú";
        del.addEventListener("click", () => {
          if(confirm("Ïù¥ Í∏ÄÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?")){
            posts = posts.filter(x => x.id !== p.id);
            delete likeMap[p.id];
            delete reportMap[p.id];
            save(LS_KEY, posts); save(LIKE_KEY, likeMap); save(REPORT_KEY, reportMap);
            render();
          }
        });
        actions.appendChild(del);
      }

      meta.appendChild(time);
      meta.appendChild(actions);

      card.appendChild(txt);
      card.appendChild(meta);
      feed.appendChild(card);
    });
  }

  function updateCount(){
    count.textContent = postInput.value.length;
    const cd = Math.max(0, (parseInt(localStorage.getItem(LAST_POST_KEY) || "0",10) + POST_COOLDOWN_MS) - now());
    if(cd > 0){
      
    }else{
      
    }
    postBtn.disabled = !(postInput.value.trim().length > 0);
  }

  function post(){
    const raw = postInput.value;
    const text = sanitize(raw);
    if(!text) return;
    if(blocked(text)){
      alert("Î∂ÄÏ†ÅÏ†àÌïú ÎÇ¥Ïö© ÎòêÎäî ÎßÅÌÅ¨Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏñ¥ Îì±Î°ùÌï† Ïàò ÏóÜÏñ¥Ïöî.");
      return;
    }
    const item = {
      id: "p_" + Date.now().toString(36) + Math.random().toString(36).slice(2,7),
      text, ts: now(), amen:0, halle:0, owner: deviceId, reports:0
    };
    posts.unshift(item);
        save(LS_KEY, posts);
    postInput.value = "";
    updateCount();
    render();
  }

  // backups
  exportBtn.addEventListener("click", () => {
    const payload = {
      exportedAt: new Date().toISOString(),
      posts, likeMap, reportMap, version:"v2"
    };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "amenclub_praywall_backup_v2.json";
    a.click();
    URL.revokeObjectURL(url);
  });

  importBtn.addEventListener("click", async () => {
    const input = document.createElement("input");
    input.type = "file"; input.accept="application/json";
    input.onchange = async () => {
      const file = input.files[0];
      if(!file) return;
      const text = await file.text();
      try{
        const data = JSON.parse(text);
        if(data.posts && Array.isArray(data.posts)){
          posts = data.posts.sort((a,b)=>b.ts-a.ts);
          likeMap = data.likeMap || {};
          reportMap = data.reportMap || {};
          save(LS_KEY, posts); save(LIKE_KEY, likeMap); save(REPORT_KEY, reportMap);
          render();
          alert("Î∞±ÏóÖÏùÑ Î∂àÎü¨ÏôîÏñ¥Ïöî.");
        }else{
          alert("Ïú†Ìö®Ìïú Î∞±ÏóÖ ÌååÏùºÏù¥ ÏïÑÎãàÏóêÏöî.");
        }
      }catch(e){
        alert("ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®");
      }
    };
    input.click();
  });

  wipeBtn.addEventListener("click", () => {
    if(confirm("Ïù¥ Í∏∞Í∏∞ÏóêÏÑú Ï†ÄÏû•Îêú ÌîÑÎ†àÏù¥Ïõî Îç∞Ïù¥ÌÑ∞Î•º Î™®Îëê ÏÇ≠Ï†úÌï†ÍπåÏöî? (Îã§Î•∏ Í∏∞Í∏∞ÏóêÎäî ÏòÅÌñ• ÏóÜÏùå)")){
      posts = [];
      likeMap = {};
      reportMap = {};
      localStorage.removeItem(LAST_POST_KEY);
      save(LS_KEY, posts); save(LIKE_KEY, likeMap); save(REPORT_KEY, reportMap);
      render();
    }
  });

  // bindings
  postBtn.addEventListener("click", post);
  clearBtn.addEventListener("click", () => { postInput.value=""; updateCount(); });
  postInput.addEventListener("input", updateCount);
  refreshBtn.addEventListener("click", render);

  // init
  updateCount();
  render();
})();
</script>
</body>
</html>
